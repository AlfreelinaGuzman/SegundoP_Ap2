@page "/R_Cobros"

@using BLL
@using Models
@inject IToastService Toast

@*
<EditForm Model="cobros" OnValidSubmit="Guardar">
    <DataAnnotationsValidator />

    <div class="card">
        <div class="card-header">
            <h2>Registro cobros</h2>
        </div>

        <div class="card-body">
            <form>
                <div class="form-group row">
                    <div class="col form-inline">
                        <label class="col-form-label mr-3">Clientes</label>
                        <select class="custom-select form-control" @bind="ClienteIndex">
                            <option value="0">Seleccionar</option>
                            @if (Clientes != null)
                            {
            @foreach (var cliente in Clientes)
            {
            <option value="@cliente.ClienteId">@cliente.Nombres</option>
            }}
                        </select>
                        @if (ClienteIndex != _ClienteIndex)
                        {
                            Cliente_InputChanged();
                        }
                    </div>
                    <a class="btn btn-dark bg-primary text-right mr-3" href="C_Cobros"><i class="oi oi-magnifying-glass" />Ver cobros</a>
                </div>

                <div class="overflow-auto">
                    <h5>Facturas pendientes</h5>
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th>Id</th>
                                <th>Fecha</th>
                                <th>Monto</th>
                                <th>Balance</th>
                                <th>Cobrado</th>
                                <th>Pagar</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < VentasPendientes.Count; i++)
                            {
                                Ventas ventas = VentasPendientes[i];
            <tr>
                <td>@ventas.VentaId</td>
                <td>@ventas.Fecha</td>
                <td>@ventas.Monto</td>
                <td>@ventas.Balance</td>
                <td>@ObtenerMontoCobro(ventas)</td>
                <td><input type="checkbox" disabled="@(!ventas.Pendiente)" checked="@(Seleccionado(ventas))" @onchange="()=> Pagar(ventas)" /></td>
            </tr>}
                        </tbody>

                        <tfoot>
                            <tr>
                                <td>Totales</td>
                                <td><input type="text" readonly value="@cobros.Detalle.Where(c => c.CobroDetalleId == 0).Count()" /></td>
                                <td></td>
                                <td></td>
                                <td><input type="text" readonly value="@cobros.ObtenerMonto()" /></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="mt-3">
                    <label>Observaciones</label><br />
                    <InputTextArea style="width:100%" @bind-Value="cobros.Observaciones"></InputTextArea>
                </div>
                <DataAnnotationsValidator />
            </form>
        </div>

        <div class="card-footer text-center">
            <button type="button" class="btn btn-lg btn-primary" @onclick="Nuevo"><i class="oi oi-file mr-2" />Nuevo</button>
            <button type="submit" class="btn btn-lg btn-success" style="margin-inline-start: 40px;"><i class="oi oi-account-login" style="transform:rotate(90deg)" /> Guardar</button>
            <button type="button" class="btn btn-lg btn-danger" @onclick="Eliminar" style="margin-inline-start: 40px;"><i class="oi oi-trash mr-2" />Eliminar</button>
        </div>
    </div>
</EditForm>
*@